---
/**
 * Reservation Section Component
 * SPEC-18 Phase 2.3: State Park Reservations & Fees Display
 *
 * Displays reservation information:
 * - Fee structure for cabins, camping, day-use
 * - Booking window information
 * - Cancellation policy
 * - Primary CTA: Phone (1-833-WV-PARKS)
 * - Secondary CTA: Online reservation link
 *
 * WVWO Aesthetics:
 * - Font: font-display (Bitter), font-body (Noto Sans)
 * - Borders: rounded-sm ONLY
 * - Colors: brand-brown, sign-green, brand-cream, brand-orange
 * - Orange CTA <5% of section area
 * - Voice: Kim's authentic WV
 */

import type { ReservationsSection } from '@/types/state-park-template-types';

interface Props {
  reservations: ReservationsSection;
  parkName: string;
}

const { reservations, parkName } = Astro.props;

// Format phone number for click-to-call
const phoneNumber = reservations?.generalContact?.phone || '1-833-982-7275'; // 1-833-WV-PARKS
const phoneLink = `tel:${phoneNumber.replace(/\D/g, '')}`;

// Default reservation URL
const defaultReservationUrl = 'https://reservations.wvstateparks.com';
const reservationUrl = reservations?.generalContact?.url || defaultReservationUrl;

// Check if section has any content
const hasContent =
  reservations?.cabins ||
  reservations?.camping ||
  reservations?.groupFacilities ||
  reservations?.generalContact;

if (!hasContent) {
  return null;
}
---

<section
  class="py-16 bg-brand-cream"
  aria-labelledby="reservations-heading"
>
  <div class="container mx-auto px-4">
    <h2
      id="reservations-heading"
      class="font-display text-4xl md:text-5xl font-black text-brand-brown mb-12"
    >
      Reservations & Fees
    </h2>

    <!-- Primary CTA Block -->
    <div class="bg-gradient-to-br from-brand-orange to-brand-orange/80 rounded-sm p-8 mb-12 text-white">
      <div class="flex flex-col md:flex-row items-center justify-between gap-6">
        <div class="text-center md:text-left">
          <p class="font-display text-2xl md:text-3xl font-bold mb-2">
            Ready to Book Your Visit?
          </p>
          <p class="text-white/90 font-body">
            Call us directly or reserve online for the best availability
          </p>
        </div>
        <div class="flex flex-col gap-3 w-full md:w-auto">
          <a
            href={phoneLink}
            class="bg-white hover:bg-brand-cream text-brand-orange font-bold py-4 px-8 rounded-sm text-center transition-colors text-lg"
            aria-label="Call WV State Parks reservation line"
          >
            ðŸ“ž {phoneNumber}
          </a>
          <a
            href={reservationUrl}
            class="bg-brand-brown hover:bg-brand-brown/90 text-white font-bold py-3 px-8 rounded-sm text-center transition-colors"
            rel="noopener noreferrer"
            target="_blank"
          >
            Reserve Online
          </a>
        </div>
      </div>
    </div>

    <!-- Cabin Fees -->
    {reservations?.cabins && (
      <div class="mb-12">
        <h3 class="font-display text-3xl font-bold text-brand-brown mb-6 border-l-4 border-l-sign-green pl-4">
          Cabin Rates
        </h3>

        <div class="bg-white rounded-sm border-2 border-brand-brown overflow-hidden">
          {reservations.cabins.fees && reservations.cabins.fees.length > 0 ? (
            <div class="overflow-x-auto">
              <table class="w-full">
                <caption class="sr-only">Cabin rental rates by type and season</caption>
                <thead class="bg-brand-brown text-brand-cream">
                  <tr>
                    <th class="px-6 py-4 text-left font-display font-bold">Cabin Type</th>
                    <th class="px-6 py-4 text-left font-display font-bold">Rate</th>
                    <th class="px-6 py-4 text-left font-display font-bold">Season</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-brand-brown/20">
                  {reservations.cabins.fees.map((fee, index) => (
                    <tr class={index % 2 === 0 ? 'bg-white' : 'bg-brand-cream/30'}>
                      <td class="px-6 py-4 font-body text-brand-brown">{fee.cabinType}</td>
                      <td class="px-6 py-4 font-bold text-brand-brown">{fee.priceRange}</td>
                      <td class="px-6 py-4 text-brand-brown/80">{fee.season || 'Year-round'}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          ) : (
            <div class="p-6">
              <p class="text-brand-brown font-body">
                Contact park for current cabin rates and availability.
              </p>
            </div>
          )}

          {reservations.cabins.bookingWindow && (
            <div class="bg-sign-green/10 px-6 py-4 border-t border-brand-brown/20">
              <p class="text-sm text-brand-brown">
                <strong>Booking Window:</strong> {reservations.cabins.bookingWindow}
              </p>
            </div>
          )}

          {reservations.cabins.cancellationPolicy && (
            <div class="px-6 py-4 border-t border-brand-brown/20">
              <p class="text-sm text-brand-brown/80 font-body">
                <strong class="text-brand-brown">Cancellation Policy:</strong> {reservations.cabins.cancellationPolicy}
              </p>
            </div>
          )}
        </div>
      </div>
    )}

    <!-- Camping Fees -->
    {reservations?.camping && (
      <div class="mb-12">
        <h3 class="font-display text-3xl font-bold text-brand-brown mb-6 border-l-4 border-l-sign-green pl-4">
          Camping Rates
        </h3>

        <div class="bg-white rounded-sm border-2 border-brand-brown overflow-hidden">
          {reservations.camping.fees && reservations.camping.fees.length > 0 ? (
            <div class="overflow-x-auto">
              <table class="w-full">
                <caption class="sr-only">Camping site rates by type and season</caption>
                <thead class="bg-sign-green text-white">
                  <tr>
                    <th class="px-6 py-4 text-left font-display font-bold">Site Type</th>
                    <th class="px-6 py-4 text-left font-display font-bold">Nightly Rate</th>
                    <th class="px-6 py-4 text-left font-display font-bold">Season</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-brand-brown/20">
                  {reservations.camping.fees.map((fee, index) => (
                    <tr class={index % 2 === 0 ? 'bg-white' : 'bg-brand-cream/30'}>
                      <td class="px-6 py-4 font-body text-brand-brown">{fee.siteType}</td>
                      <td class="px-6 py-4 font-bold text-brand-brown">{fee.price}</td>
                      <td class="px-6 py-4 text-brand-brown/80">{fee.season || 'Year-round'}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          ) : (
            <div class="p-6">
              <p class="text-brand-brown font-body">
                Contact park for current camping rates and availability.
              </p>
            </div>
          )}

          {reservations.camping.bookingWindow && (
            <div class="bg-sign-green/10 px-6 py-4 border-t border-brand-brown/20">
              <p class="text-sm text-brand-brown">
                <strong>Booking Window:</strong> {reservations.camping.bookingWindow}
              </p>
            </div>
          )}

          {reservations.camping.cancellationPolicy && (
            <div class="px-6 py-4 border-t border-brand-brown/20">
              <p class="text-sm text-brand-brown/80 font-body">
                <strong class="text-brand-brown">Cancellation Policy:</strong> {reservations.camping.cancellationPolicy}
              </p>
            </div>
          )}
        </div>
      </div>
    )}

    <!-- Group Facilities -->
    {reservations?.groupFacilities && (
      <div class="mb-12">
        <h3 class="font-display text-3xl font-bold text-brand-brown mb-6 border-l-4 border-l-sign-green pl-4">
          Group Facilities & Pavilions
        </h3>

        <div class="bg-white rounded-sm border-2 border-brand-brown p-6">
          {reservations.groupFacilities.fees && reservations.groupFacilities.fees.length > 0 ? (
            <div class="space-y-4 mb-6">
              {reservations.groupFacilities.fees.map((fee) => (
                <div class="flex items-center justify-between py-3 border-b border-brand-brown/20 last:border-0">
                  <span class="font-body text-brand-brown">{fee.facilityType}</span>
                  <span class="font-bold text-brand-brown">{fee.price}</span>
                </div>
              ))}
            </div>
          ) : (
            <p class="text-brand-brown font-body mb-6">
              Group facilities available for rent. Contact park for rates and availability.
            </p>
          )}

          {reservations.groupFacilities.bookingContact && (
            <p class="text-sm text-brand-brown/80">
              <strong>Contact:</strong> {reservations.groupFacilities.bookingContact}
            </p>
          )}
        </div>
      </div>
    )}

    <!-- Important Reservation Information -->
    <!-- TODO: Make configurable via reservations.importantNotes in future iteration -->
    <div class="bg-white rounded-sm border-l-4 border-l-brand-orange p-6">
      <h3 class="font-display text-xl font-bold text-brand-brown mb-4">
        Important Reservation Information
      </h3>
      <ul class="space-y-3 font-body text-brand-brown/80">
        <li class="flex items-start gap-3">
          <span class="text-sign-green flex-shrink-0 mt-1">âœ“</span>
          <span>Reservations are highly recommended, especially during peak season (May-October)</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="text-sign-green flex-shrink-0 mt-1">âœ“</span>
          <span>Check-in times vary by facility type - confirm when booking</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="text-sign-green flex-shrink-0 mt-1">âœ“</span>
          <span>West Virginia residents receive discounted rates on camping and day-use fees</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="text-sign-green flex-shrink-0 mt-1">âœ“</span>
          <span>Annual park passes available - great value for frequent visitors</span>
        </li>
        <li class="flex items-start gap-3">
          <span class="text-sign-green flex-shrink-0 mt-1">âœ“</span>
          <span>Cancellation policies apply - review terms when booking</span>
        </li>
      </ul>
    </div>
  </div>
</section>

<style>
  /* Table responsive scroll shadow */
  .overflow-x-auto {
    scrollbar-width: thin;
    scrollbar-color: theme('colors.brand-brown') theme('colors.brand-cream');
  }

  .overflow-x-auto::-webkit-scrollbar {
    height: 8px;
  }

  .overflow-x-auto::-webkit-scrollbar-track {
    background: theme('colors.brand-cream');
  }

  .overflow-x-auto::-webkit-scrollbar-thumb {
    background: theme('colors.brand-brown');
    border-radius: 4px;
  }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    * {
      transition: none !important;
    }
  }
</style>
