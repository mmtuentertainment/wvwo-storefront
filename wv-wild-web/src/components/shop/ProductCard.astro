---
/**
 * ProductCard.astro - Product display card for shop pages
 * Shows product image, name, price, and CTA based on shippable status
 */
import { SITE_CONTACT } from '../../config/siteContact';

interface Props {
  product: {
    id: string;
    slug: string;
    categoryId: string;
    brand: string;
    name: string;
    shortName: string;
    description: string;
    price: number;
    priceDisplay: string;
    priceUnit: string;
    images: string[];
    shippable: boolean;
    fflRequired: boolean;
    inStock: boolean;
  };
  categorySlug: string;
}

const { product, categorySlug } = Astro.props;

// Get category info for link
import storeData from '../../data/store.json';
const category = storeData.categories.find(c => c.id === product.categoryId);
const catSlug = categorySlug || category?.slug || product.categoryId;
---

<article class="bg-white rounded-sm shadow-sm border border-stone-100 overflow-hidden hover:shadow-md transition-shadow group">
  <!-- Product Image -->
  <a href={`/shop/${catSlug}/${product.slug}`} class="block aspect-square bg-white overflow-hidden">
    {product.images[0] ? (
      <img
        src={product.images[0]}
        alt={product.name}
        width="800"
        height="800"
        class="w-full h-full object-contain p-2 group-hover:scale-105 transition-transform duration-300"
        loading="lazy"
      />
    ) : (
      <div class="w-full h-full flex items-center justify-center bg-stone-200">
        <svg class="w-16 h-16 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
      </div>
    )}
  </a>

  <!-- Product Info -->
  <div class="p-4">
    <!-- Brand -->
    <span class="text-xs text-brand-orange font-medium uppercase tracking-wide">
      {product.brand}
    </span>

    <!-- Name -->
    <h3 class="font-display font-bold text-brand-brown mt-1 line-clamp-2">
      <a href={`/shop/${catSlug}/${product.slug}`} class="hover:text-brand-orange transition-colors">
        {product.shortName || product.name}
      </a>
    </h3>

    <!-- Price -->
    <div class="mt-2 flex items-baseline gap-2">
      <span class="text-lg font-bold text-brand-brown">
        {product.priceDisplay}
      </span>
      {product.priceUnit && product.priceUnit !== 'each' && (
        <span class="text-xs text-stone-500">
          {product.priceUnit}
        </span>
      )}
    </div>

    <!-- Stock Status -->
    <div class="mt-2">
      {product.inStock ? (
        <span class="inline-flex items-center gap-1 text-xs font-medium text-sign-green">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
          </svg>
          In Stock
        </span>
      ) : (
        <span class="inline-flex items-center gap-1 text-xs font-medium text-stone-500">
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
          </svg>
          Call for Availability
        </span>
      )}
    </div>

    <!-- CTA Button -->
    <div class="mt-4">
      {product.shippable ? (
        <!-- Shippable items get View Details (stock status already shown above) -->
        <a
          href={`/shop/${catSlug}/${product.slug}`}
          class="w-full inline-flex items-center justify-center gap-2 bg-sign-green text-white font-bold px-4 py-2.5 rounded hover:bg-sign-green/90 transition-colors text-sm"
        >
          View Details
        </a>
      ) : (
        <a
          href={SITE_CONTACT.phoneHref}
          class="w-full inline-flex items-center justify-center gap-2 bg-brand-brown text-white font-bold px-4 py-2.5 rounded hover:bg-brand-brown/90 transition-colors text-sm"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
          </svg>
          Call to Order
        </a>
      )}
    </div>

    <!-- FFL Notice for firearms/ammo -->
    {product.fflRequired && (
      <p class="mt-2 text-xs text-stone-500 text-center">
        Requires background check
      </p>
    )}
  </div>
</article>
